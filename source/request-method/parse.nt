import {
  this.private.parse {_symbol},
  this.request-method {
    DELETE,
    GET,
    HEAD,
    OPTIONS,
    PATCH,
    POST,
    PUT,
    TRACE,
    request-method,
  },
  zonk.parser {fail, parser, return, zonk},
  zonk.tag {Label},
}

define request-method-parser(): parser(request-method) {
  with zonk {
    bind method-text = _symbol() in
    let method-or-none on method-text =
      if eq-text(method-text, "GET") {
        OK(GET)
      } else-if eq-text(method-text, "HEAD") {
        OK(HEAD)
      } else-if eq-text(method-text, "POST") {
        OK(POST)
      } else-if eq-text(method-text, "PUT") {
        OK(PUT)
      } else-if eq-text(method-text, "DELETE") {
        OK(DELETE)
      } else-if eq-text(method-text, "OPTIONS") {
        OK(OPTIONS)
      } else-if eq-text(method-text, "TRACE") {
        OK(TRACE)
      } else-if eq-text(method-text, "PATCH") {
        OK(PATCH)
      } else {
        Error(Unit)
      }
    in
    let _ = method-text in
    match method-or-none {
    | OK(method) =>
      return(method)
    | Error(_) =>
      fail([Label("request method")])
    }
  }
}
